#ifndef AGG_WEB2_BIZ_KNOWLEDGE_SIMPLE_RANK_PROCESSOR_H
#define AGG_WEB2_BIZ_KNOWLEDGE_SIMPLE_RANK_PROCESSOR_H

#include <agg2/common/agg_common.h>
#include <agg2/processor/base_processor.h>

//#include <agg_web2/common/common.h>
//#include <agg2/util/string_tool.h>
//#include <agg_web2/util/AggWebStringTool.h>
//#include <jsoncpp/json/json.h>

AGG_BEGIN_NAMESPACE(agg_web2);

class SimpleRankProcessor : public BaseProcessor
{
public:
    SimpleRankProcessor();
    virtual ~SimpleRankProcessor();

public:
    virtual bool DoInit(const String2String & params) override;
    virtual void DoRegisterMetric(AmonitorRegister *monitorRegister) override;
    virtual BaseProcessor * DoClone() override;
    virtual void DoDestroy() override;
    virtual int DoProcess(AggContext * aggContext) override;

public:
    // register UDF MethodFunc
    virtual bool RegisterMethods() override;

public:
    // register UDF actor
    virtual bool RegisterActors() override;

private:
    //void RequestFormatResult();
    void FormatValidResult(const std::string rawQuery, const std::string matchQuery, const std::string matchView, const double qt_score, const std::string message);
    void FormatEmptyResult(const std::string message);
    std::vector<double> GetQtScores(AggContext* aggContext, const std::string& query, const std::vector<std::string>& titles);
    
    /*void SplitDoc2Psg(std::vector<LLMDocPtr>& LLMDocPtrQueue);
    void GetScores(std::vector<LLMDocPtr>& LLMDocPtrQueue);
    void SelectDocs(std::vector<LLMDocPtr>& LLMDocPtrQueue, std::string& Source);

	void GetRerankResult(std::vector<LLMDocPtr>& docPtrVec, std::string& Source);
    bool GetAggResult(std::vector<LLMDocPtr>& docPtrVec);
    
    HttpResponsePtr RequestQTC(std::string& qtc_request_dat);
    std::vector<double> GetQTC(HttpResponsePtr resp);
    void BatchRequestQTC(const std::string& query,
            std::vector<LLMPsgPtr>& cands,
            std::vector<std::vector<LLMPsgPtr>>& psgSampleVec,
            std::vector<HttpResponsePtr>& qtcRespVec);
    void FilterRequestQtc(std::vector<LLMDocPtr>& LLMDocPtrQueue, const std::string& query, bool NeedFilter);
    void FilterRequestPrNew(std::vector<LLMDocPtr>& LLMDocPtrQueue, const std::string& query, bool NeedFilter);
*/
private:
    std::string mDebugInfo;
    std::string mQTCNode;

private:
    AGG_LOG_DECLARE();
    DECLARE_SERIALIZATION_FUNC();
};

AGG_TYPEDEF_PTR(SimpleRankProcessor);

AGG_END_NAMESPACE(agg_web2);

#endif //AGG_WEB2_BIZ_KNOWLEDGE_SIMPLE_RANK_PROCESSOR_H
