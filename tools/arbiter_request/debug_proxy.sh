query='TP=0&TS=0%6010&_request_app_names=KgRecSpecialTopicTop%2Canime_star%2Ceducation-server%2Ceducation_hanyu%2Cetao_shopping%2Cfinancial_report%2Cgaokao_predict%2Cgaokao_university_ranking%2Cgaokao_zhenti%2Cgouwu_jingyan%2Chospital%2Ckg-medical-alihealth%2Ckg_medical_audio%2Ckg_medical_doc%2Ckg_medical_entity%2Ckg_medical_jxwd%2Ckg_medical_qa%2Ckg_medical_video%2Clima_sc%2Cmini_program%2Cmuying-neng-bu-neng-chi%2Cpeoplestarzeus%2Cpublication%2Csc_knowledge%2Cselected_wenda%2Csm-e-learning%2Csm_qa_recommend%2Csm_shopping%2Cvideo%2Cvideo_music%2Cviewpoint%2Cyisou%2Cyisou_pan&_request_app_timeout=550&_trace_app_names=education-server&adt_src=1&adult_confidence=0&adult_demote=255&adult_level=0&adult_score=0.000112627&app_rewrite=%E5%85%A5%E5%85%9A%E7%94%B3%E8%AF%B7%E4%B9%A6%010%01501%01%E5%85%A5%E5%85%9A%E7%94%B3%E8%AF%B7%E4%B9%A6%011%010&app_ve=0&belong=search&bi=&blueray=0&body_summary_conf=2%601100%601%3Cem%3E%601%3C%2Fem%3E%601...&bucket=novel_ali_prior%3Don%26life_show_general_image%3Dbucket_3%26sitelink%3Dbucket_2_1%26dahanghai_video%3Dbase%26quark_book_search_stype%3Dlayerb%26xyst_boost%3Db1%26med_site_demote%3D5ikang%26med_app_site_demote_health_qa_juhe%3Dclose%26selected_wenda_exp%3Db5%26hq_qanchor_index%3Dbase%26exp_ufs_agg_model%3Dbucket_ufs%26goldbridge_yisou_film%3Dbucket2%26component_retrigger%3Dbucket_2%26arrival_coolin%3Dbucket_video%26high_quality_content_new%3Dnew_new%26zuesrecut%3Dbucket2%26doc_qa_juhe%3Dno_cutoff_doc%26site_aggregator%3Dbase%26QueryLogMakeUp%3Dbucket2%26precise_answer%3Dbucket3%26ab_at_second%3Dbucket2%26ab_querylog_cache%3Dopen%26feed_video_timeliness%3Dbad%26knowledge_prd_video_service%3Dnew2%26health_exports_qa%3Dbucket_2%26jxwd_qa_juhe%3Dno_cutoff_jxwd%26rec_wenda%3Dbucket8%26bert_textscore%3Dbucket_BertL4ACScore%26feed_replace_index%3Dbucket_2%26zimg_replace%3Dbucket_2%26agg_medical_makeup%3Dopen%26qa_search%3Db1%26map_for_feiyan%3Don%26qa_quark%3Db0%26knowledge_org%3Dbucket1%26wenda_tiji%3Dbucket_1%26wenda_weini%3Dbucket_1%26healthcare_tags_exp%3Dend%26quark_prediction%3Dbucket1%26novel_ali_makeup%3Don%26news_video_rerank_all%3Dgood%26quark_rec%3Dbucket5%26answer_for_quark%3Dbucket2%26timeliness_rerank%3Dbucket_2%26ab_tt_qlog%3Dbucket_3%26query_bidword%3Dbucket2%26qcontent%3Dbucket_22%26router_sc_bucket%3Dopen%26goldbridge_qc_edu-xiti%3Dbucket_1%26relative_search%3Dbucket_7%26news_uchq%3Dbucket1%26senior_agg_web%3Dbucket_2%26quark_prediction_new%3Dbucket3%26jxwd_medical_evade%3Don%26yisou_wakuang%3Dbucket2%26news_sc_model_rerank%3Dgood%26goldbridge_novel%3Dbucket_1%26goldbridge_common%3Dbucket_1%26paa_recommend%3Dbucket2%26news_sc_news_rank%3Dgood%26goldbridge_wordcup%3Dbucket_1%26novel_merge_v1%3Don%26exp_ufs_agg_feature%3Dbucket_ufs%26goldbridge_yisou_tv_see%3Dbucket_1%26goldbridge_variety%3Dbucket_1%26news_sc_agg_rerank%3Dgood%26goldbridge_animation%3Dbucket_1%26yiliao_adjust%3Dbucket_1%26useqccache%3Dbucket_2%26ab_qlog_merge%3Dbucket_2%26ab_query_rewrite_zeus%3Dbucket_2%26lima_sc%3Dnew%26goldbridge_song%3Dbucket_1%26expert_qa_juhe%3Dclose%26qccachetime%3D172800%26agg_model%3Dbucket_2%26qa_qp%3Db0%26goldbridge_video_list%3Dbucket_1%26zeus_people_star%3Dbucket_org%26goldbridge_pic%3Dbucket_1%26pic_quality_score%3Dbucket4%26job_website_traffic%3Dbucket2%26video_mid_third%3Don%26job_list_traffic%3Dbucket2%26feed_news_new%3Dmain%26ab_index_degrade%3Dbucket_degrade%26orion_cms_switch%3Dbucket_cms%26ge_poetry%3Dbucket_2%26novel_authorized_shift%3Don%26yiliao_struct_new%3Dclose%26feed_data%3Dtoutu_mix7%26summary_sentence_ranking%3Dbucket2%26quark_book_search%3Don%26orion_cms_switch_feed%3Dbucket_cms%26orion_cms_switch_banner%3Dbucket_cms%26timeliness%3Dhotgood_attention%26zeus_spl%3Dbucket_2%26zuowen_test%3Dbucket1%26novel_17k_boost%3Doff%26agg_news_intention%3Dgood%26ab_insert%3Dbucket_3%26clean2020%3Dnew%26dict_hanyu_ab_test%3D01%26paa_recommend_mutex%3Dopen%26fow_recommend_mutex%3Dopen%26novel_uc%3Dbase%26novel_agg_flow%3Dbucket_a%26bd_icon_new%3Db13%26alihealth_wenzhen%3Dnew2%26bd_icon_new_ios%3Dk15%26test_high_quality_content%3Dbase%26test_viewpoint%3Dbase%26kg_recommend_multi_dimension%3Ddefault%26uc_flow_bts%3Dbkt1%26qc_cluster_2080%3D840%26qc_cluster_p100%3D160%26goldbridge_qc_adult%3Dbucket_1%26qu_request%3Don%26novel_copyright_cutoff%3Dopen%26summary_modify_full_2%3Dbucket_2%26strategy_analysis%3Dbucket_1%26ali_health_doctor%3Dclose%26ge_poetrylist%3Dbucket_2%26small_video%3Ddefault%26education_server_fasttext_ab_test%3D00%26timeliness_boost%3Dbucket_2%26medical_new_sc%3Dnew%26school_open%3Don%26tiny_app_test%3Dbucket1%26quark_med_full%3Dopen%26o2o_life_show%3Dbucket_2%26wenda_selected_new%3Dbucket2%26ab_simi_doc_replace%3Dbucket_2%26ab_querylog%3Dclose%26qa_select%3Dexp10_19%26wenda_selected_datatype%3Dbase%26goldbridge_qc_health%3Dbucket_1%26goldbridge_etao_shopping%3Dbucket_1%26goldbridge_film_ticket%3Dbucket_1%26ab_customer_tree%3Dbucket_2%26government_service%3Don%26pic_tupianxiu%3Dbase%26knowledge_video_service%3Doff%26struct_unify%3Dbase%26arrival_summary%3Dbucket_base%26ab_tt_crawltime%3Dbucket_2%26goldbridge_queryset%3Dbucket_1%26publication%3Don%26ge_foreign_college%3Dbucket_2%26bert_ufs_v2_textscore%3Dbucket_BertL4ACScoreV2_Exam0%26edu_opt%3Dbucket0%26ab_simdoc_tair%3Dbucket_2%26starry%3Dbucket3%26ab_simdoc_senior%3Dbucket_2%26union_to_web%3Dbase%26querylog_wenda%3Dbucket_2%26quark_law_service%3Don%26zuowen_zaoju_test%3Dbucket1%26qa_juhe%3Dno_cutoff%26no_wenda_juhe%3Dbucket_2%26ab_operation_jy_news%3Don_other%26xiami%3Dbucket2%26knowledge%3Dbucket1%26news_video_trigger%3Dvideo%26quark_sug%3Dbucket2%26guandian%3Dbucket_1%26novel_authorized_rank%3Don%26agg_wenda_juhe_test%3Dnew%26quest_log%3Dbucket_2%26news_sc_news_add%3Dupdate_good%26feature_log_collector%3Doff%26audio_qa_juhe%3Dno_cutoff_audio%26top_sc_bucket%3Dclose%26video_qa_juhe%3Dno_cutoff_video%26normal_sc_bucket%3Dclose%26novel_pinglun%3Dbase%26pic_trigger%3Dopen%26wenda_santai_test%3Dbucket_1%26union_bts%3Dtest4%26quark_search%3Don%26jxwd_dedup%3Dnew%26bucket_bangdan_id_test%3Dbucket_1&chinese_space=0&cid=9&city=%E6%9D%AD%E5%B7%9E&content_intention=%7B%22hits%22%3A%5B%7B%22long%22%3A%7B%22DS%22%3A%7B%22doc%22%3A%22kvmap%22%2C%22notrigger%22%3A%22kvmap%22%2C%22pv%22%3A%22kvmap%22%2C%22qa%22%3A%22kvmap%22%2C%22qcls%22%3A%22kvmap%22%2C%22recalltype%22%3A%22kvmap%22%2C%22uccates%22%3A%22kvmap%22%2C%22video%22%3A%22kvmap%22%7D%2C%22notrigger%22%3A1%2C%22pv%22%3A23376%2C%22qcls%22%3A%22%5B%7B%5C%22score%5C%22%3A0.907%2C%5C%22id%5C%22%3A%5C%2214%5C%22%2C%5C%22cls%5C%22%3A%5C%22edu%5C%22%7D%2C%7B%5C%22score%5C%22%3A0.045%2C%5C%22id%5C%22%3A%5C%2230%5C%22%2C%5C%22cls%5C%22%3A%5C%22politics%5C%22%7D%2C%7B%5C%22score%5C%22%3A0.017%2C%5C%22id%5C%22%3A%5C%2245%5C%22%2C%5C%22cls%5C%22%3A%5C%22violate%5C%22%7D%2C%7B%5C%22score%5C%22%3A0.017%2C%5C%22id%5C%22%3A%5C%2247%5C%22%2C%5C%22cls%5C%22%3A%5C%22law%5C%22%7D%2C%7B%5C%22score%5C%22%3A0.013%2C%5C%22id%5C%22%3A%5C%2212%5C%22%2C%5C%22cls%5C%22%3A%5C%22health%5C%22%7D%5D%22%2C%22recalltype%22%3A%7B%22doc%22%3A2%2C%22qa%22%3A1%2C%22video%22%3A1%7D%2C%22uccates%22%3A%7B%22%E5%9B%BD%E5%86%85%22%3A1%2C%22%E6%97%B6%E6%94%BF%22%3A1%7D%7D%7D%5D%2C%22numhits%22%3A1%2C%22status%22%3A0%7D&cookieid=3524be495fc236edc65d51dd77ebcdc3%7C%7C%7C1592214194&debug=arbiter_trace1&device=&disable_repeat_score=1&district=&dn=&ds=&ei=&event_syn=&ext=&ext_kv=&external=0&feed_news=feed&fi=0&filter=&filter_id=0&flow_level=800&format=protobuf&formulaName=&fr=ios&from=&gi=&guid_info=%E5%85%A5%E5%85%9A%E7%94%B3%E8%AF%B7%E4%B9%A6%602style%602missing%6020&hid=6692641ffcad624d75e0877dc1a4a214&industry_small_traffic=app&ip=42.120.75.78&is_http_url=0&jb=&latitude=&longitude=&lstm_adult=0.00185601&me=&medical_intention=%7B%22label%22%3A%221%22%2C%22query%22%3A%22%E5%85%A5%E5%85%9A%E7%94%B3%E8%AF%B7%E4%B9%A6%22%2C%22score%22%3A0.002556243911385536%2C%22source%22%3A%22model%22%7D&mode=xxx&nav_main_sc=&nav_param=&nav_query=&nav_sc=&new_guid_info=term%603%E5%85%A5%E5%85%9A%E7%94%B3%E8%AF%B7%E4%B9%A6%602guid%603missing%602notable_types%603%602hot%6030&new_semantic_info=0%6032%6021801%6044&news_class=2&no_sug=0&norm_query=%E5%85%A5%E5%85%9A%E7%94%B3%E8%AF%B7%E4%B9%A6&nt=&nw=&or_logic=v2&ori_query=%E5%85%A5%E5%85%9A%E7%94%B3%E8%AF%B7%E4%B9%A6&part_sum=22430&pf=&phrase=phrase%3A%27%E5%85%A5%E5%85%9A%27+AND+phrase%3A%27%E7%94%B3%E8%AF%B7%27+AND+phrase%3A%27%E4%B9%A6%27&pr=&province=%E6%B5%99%E6%B1%9F&pv=147905&q=%E5%85%A5%E5%85%9A%E7%94%B3%E8%AF%B7%E4%B9%A6&qa_qp=b0&qc_explain=edu%602%E5%85%A5%E5%85%9A%E7%94%B3%E8%AF%B7%E4%B9%A6%604style%602%601common%602%602zeus_qc&qc_result=edu%60214%6027&qi=&qn=%E5%85%A5%E5%85%9A%E7%94%B3%E8%AF%B7%E4%B9%A6&qnsm=%E5%85%A5%E5%85%9A%E7%94%B3%E8%AF%B7%E4%B9%A6%6021801&qnsm2=%E5%85%A5%E5%85%9A%E7%94%B3%E8%AF%B7%E4%B9%A6%6021801%6044&qqv=0&qsm=%E5%85%A5%E5%85%9A%E7%94%B3%E8%AF%B7%E4%B9%A6&qsr=%E5%85%A5%E5%85%9A%601%E7%94%B3%E8%AF%B7%601%E4%B9%A6&query_city=&query_fi=0&query_fi_tips=&query_fi_type=white&query_province=&query_proximity=4%6017%6017&query_proximity_position=0%6011%6012&query_proximity_switch=0%6010%6010&query_type=64&question_value=0&raw_pv=147905&relevant_info=%601%601&request_from=aggregator_web&request_sc=&reservation_include=no&retrieve_len_list=2%6012%6011&retrieve_num=3&sc_info=&sc_music_alias=&sc_trigger_info=%E5%85%A5%E5%85%9A%E7%94%B3%E8%AF%B7%E4%B9%A6%02501%020&sc_trigger_rewrite=&sc_trigger_type=&scoring_query=%E5%85%A5%E5%85%9A%601%E7%94%B3%E8%AF%B7%601%E4%B9%A6&search_type=wap&second_search_add=true&semantic_info=0%6031%6032%6028198%60346%6030%6029&semantic_query=%E5%85%A5%E5%85%9A%E7%94%B3%E8%AF%B7%E4%B9%A6&sl=100&sm_gi=&sp=on&st=wap&strong_topic=&timeliness=0%6010%6010%603129%603NewsType%6040%6012%6010.406919%6012%6014%60219%602129%6020%6010%6010%6020%6020%6020%6020%6020%6020%6020%6020%6011%602year%6010%601-1.0&title_summary_conf=1%60154%601%3Cem%3E%601%3C%2Fem%3E%601...&tl=54&token_weighting=8%6016%6015&topnAcFeatureThrehold=200&tp=0&trace_scnames=zuowen_list_new&ua=Mozilla%2F5.0+%28iPhone%3B+CPU+iPhone+OS+13_2_3+like+Mac+OS+X%29+AppleWebKit%2F605.1.15+%28KHTML%2C+like+Gecko%29+Version%2F13.0.3+Mobile%2F15E148+Safari%2F604.1&uads=&uid=3524be495fc236edc65d51dd77ebcdc3%7C%7C%7C1592214194&url_summary_conf=1%601%601%3Cb%3E%601%3C%2Fb%3E%601...&user_label=&ut=&ve=&vendor=100002&vm=&weibo_trigger=0'

function array_contains() { 
    local n=$#
    local value=${!n}
    for ((i=1;i < $#;i++)) {
        if [ "${!i}" == "${value}" ]; then
            echo "y"
            return 0
        fi
    }
    echo "n"
    return 1
}

../cm2_client/cm_query  -f ../cm2_client/na61_zeus_cm_ctrl.cfg -c getcluster -v 'sc_proxy_2' | awk '{if(/_spec/){print $1" "$4" "$5}}' RS='node' | awk '{print $2":"$4" "$6" "$8" "$9}' FS='[:| ]'
ips=( $( ../cm2_client/cm_query  -f ../cm2_client/na61_zeus_cm_ctrl.cfg -c getcluster -v 'sc_proxy_2' | awk '{if(/_spec/){print $1" "$4" "$5}}' RS='node' | awk '{print $2":"$4" "$6" "$8}' FS='[:| ]' | awk '{if($2=="online" && $3 =="normal"){print $1}}') )
ips_len=${#ips[@]}

for ip in "${ips[@]}"
do
    echo "request" "${ip}"
    python send_proxy_request.py ${ip} $query > output/$ip
done

received=( $( grep "zuowen_list_new26DB5BBD-" output/* | awk '{print $2":"$3}' FS='[/:]') )
received_len=${#received[@]}

echo "sent " $ips_len ", received " $received_len

for ip in "${ips[@]}"
do
    res=$(array_contains "${received[@]}" "$ip")
    if [[ $res == "n" ]]; then
        echo $ip "invalid response"
    fi
done
